<DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - ESP8266 Configuration Portal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="debug.css">
</head>
<body class="dark-mode">
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">ESP8266 Configuration Portal</h1>
            </div>
        </header>

        <nav class="main-nav">
            <div class="nav-container">
                <a href="/" class="nav-item" data-tab="wifi">
                    <span class="nav-icon">üì∂</span>
                    <span class="nav-text">WiFi Configuration</span>
                </a>
                <a href="/slaves.html" class="nav-item" data-tab="slaves">
                    <span class="nav-icon">üîß</span>
                    <span class="nav-text">Modbus Slaves</span>
                </a>
                <a href="/settings.html" class="nav-item" data-tab="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Settings</span>
                </a>
                <a href="/debug.html" class="nav-item active" data-tab="debug">
                    <span class="nav-icon">üêõ</span>
                    <span class="nav-text">Debug</span>
                </a>
            </div>
        </nav>

        <main class="main-content">
            <div class="content-header">
                <h2>Debug Console</h2>
                <p class="content-description">
                    Monitor MQTT messages in real-time. Table shows structured data parsed from MQTT messages.
                </p>
            </div>

            <!-- Simple Debug Toggle -->
            <div class="debug-controls">
                <label class="toggle-label">
                    <span>MQTT Debug Mode:</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="debugEnabled">
                        <span class="toggle-slider"></span>
                    </div>
                    <span id="debugStatus">OFF</span>
                </label>
                <p class="section-description">
                    ON: Messages go to MQTT + Web Interface | OFF: Messages go to MQTT only
                </p>
            </div>

            <!-- Dynamic Data Table - Always Visible -->
            <div class="config-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <span class="nav-icon">üìä</span>
                        Live Data Table
                    </h3>
                    <button class="btn btn-secondary" id="clearTable" style="margin-top: 8px;">Clear Table</button>
                </div>
                <div class="table-container">
                    <table class="data-table debug-table" id="dataTable">
                        <thead>
                            <tr>
                                <th>Real Time</th>
                                <th>Since Prev</th>
                                <th>Since Same</th>
                                <th>Device</th>
                                <th>ID</th>
                                <th>Topic</th>
                                <th>Data</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="7" class="no-data">MQTT Debug Mode is OFF. Enable to see data.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Panel -->
            <section class="config-panel" aria-labelledby="info-heading">
                <header class="panel-header">
                    <h3 id="info-heading" class="panel-title">
                        <span class="panel-icon">‚ÑπÔ∏è</span>
                        How to Use
                    </h3>
                </header>
                
                <div class="section-description">
                    <p><strong>Debug Console - How to Use</strong></p>
                    
                    <p><strong>Getting Started:</strong></p>
                    <p>‚Ä¢ Toggle <strong>MQTT Debug Mode</strong> to ON to begin message capture</p>
                    <p>‚Ä¢ Table will automatically display incoming structured data</p>
                    <br>
                    <p><strong>Understanding the Display:</strong></p>
                    <p>‚Ä¢ <strong>Live Data Table</strong> - Structured view showing device, ID, topic, and parsed values</p>
                    <p>‚Ä¢ <strong>Time Column</strong> - Shows time since previous message (0s = most recent)</p>
                    <br>
                    <p><strong>Data Persistence:</strong></p>
                    <p>‚Ä¢ Debug mode only updates and loads when in debug page</p>
                    <p>‚Ä¢ Last 30 messages are stored and reloaded when returning</p>
                    <p>‚Ä¢ Timestamps show actual message receipt time, not viewing time</p>
                    <br>
                    <p><strong>Managing Data:</strong></p>
                    <p>‚Ä¢ Use <strong>Clear Table</strong> to reset the structured data view</p>
                    <p>‚Ä¢ System automatically removes oldest messages after 30 new ones</p>
        
                </div>
            </section>
        </main>

        <footer class="app-footer">
            <div class="footer-content"></div>
        </footer>
    </div>

    <script src="utils.js"></script>
    <script src="debug.js"></script>
</body>
</html>